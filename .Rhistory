random_dates <- telem_snow %>%
filter(!is.na(speed)) %>%
filter(!is.na(SnowAccum)) %>%
group_by(Device) %>%
filter(!(CamDate %in% snowfall_dates$category_date)) %>%
sample_n(6,replace = FALSE) %>%
select(Device,CamDate)
View(random_dates)
View(random_dates)
View(snowfall_dates)
random_telem %>% telem_snow
random_telem <- telem_snow
random_telem <- telem_snow %>%
group_by(Device) %>%
filter(CamDate %in% random_dates$CamDate)
length(unique(random_dates$CamDate))
length(unique(random_dates$Device))
random_dates <- telem_snow %>%
filter(!is.na(speed)) %>%
filter(!is.na(SnowAccum)) %>%
group_by(Device) %>%
filter(!(CamDate %in% snowfall_dates$category_date)) %>%
sample_n(6,replace = FALSE) %>%
select(Device,CamDate)
length(unique(random_telem$CamDate))
length(unique(random_telem$Device))
random_telem <- telem_snow %>%
group_by(Device) %>%
filter(CamDate %in% random_dates$CamDate)
random_telem$snowfall_category = "control"
max(random_telem$SnowAccum)
snowfall_dates <- snowfall_dates %>%
select(-c(Camera,SnowAccum,SnowDepth))
snowfall_telem <- right_join(telem_snow,snowfall_dates,
by = c("Device" = "Device",
"CamDate" = "category_date"))
snowfall_telem <- plyr::rbind.fill(snowfall_telem,random_telem)
unique(snowfall_telem$snowfall_category)
# Export category dates for reference
random_telem <- random_telem %>%
rename(category_date = CamDate) %>%
select(Device,snowfall_category,category_date)
snowfall_dates <- plyr::rbind.fill(snowfall_dates,random_telem)
names(random_telem)
names(random_dates)
random_dates$snowfall_category = "control"
# Export category dates for reference
random_dates <- random_dates %>%
rename(category_date = CamDate) %>%
select(Device,snowfall_category,category_date)
snowfall_dates <- plyr::rbind.fill(snowfall_dates,random_telem)
# Isolate snowfall events
snowfall_events <- telem_snow %>%
filter(SnowAccum >= 5) %>%
# distinct(Camera,CamDate,.keep_all=TRUE) %>% # 35 unique snowstorms
distinct(Device,CamDate,.keep_all=TRUE) %>% # 57 total observations
select(Camera,CamDate,SnowAccum,SnowDepth,Device) %>%
dplyr::arrange(CamDate)
length(unique(snowfall_events$Device)) # Across 17 collars
# Compute summary statistics
# How many snowfall events did each wolf experience
summary <- snowfall_events %>%
group_by(Device) %>%
summarize(no_of_snowfall = length(unique(CamDate)))
mean(summary$no_of_snowfall) # x = 3.35 snowfall events per wolf
sd(summary$no_of_snowfall) # sd = 2.17
range(summary$no_of_snowfall) # range = 1 to 7
rm(summary)
# Issues:
# Device IDs 33670, 33673, and 33675 experienced a snowfall
# on two consecutive days: 2013-03-21 and 2013-03-22
# Snowfalls on 2013-01-18 and 2013-01-24 have overlapping dates if
# selecting from three days before to three days after
# Selecting from two days before to three days after would avoid overlap
snowfall_events <- snowfall_events %>%
mutate(two_before = CamDate - 2,
one_before = CamDate - 1,
one_after = CamDate + 1, two_after = CamDate + 2,
three_after = CamDate + 3)
# For 03-21 and 03-22, code both days as "snowfall", and start
# working backwards from 2013-03-21 and forwards from 2013-03-22
for (i in 1:nrow(snowfall_events)) {
if (snowfall_events$CamDate[i] == "2013-03-21"){
snowfall_events$one_after[i] = snowfall_events$CamDate[i] + 2
snowfall_events$two_after[i] = snowfall_events$CamDate[i] + 3
snowfall_events$three_after[i] = snowfall_events$CamDate[i] + 4
}
else if (snowfall_events$CamDate[i] == "2013-03-22"){
snowfall_events$one_before[i] = snowfall_events$CamDate[i] - 2
snowfall_events$two_before[i] = snowfall_events$CamDate[i] - 3
} else {
}
}
rm(i)
# Switch to long format
snowfall_events <- snowfall_events %>%
rename(day_of_snowfall = CamDate) %>%
tidyr::gather(key = snowfall_category, value = category_date,
one_before,two_before, day_of_snowfall, one_after,
two_after, three_after) %>%
group_by(Device) %>%
dplyr::arrange(Device,category_date)
# Create controls
# Controls are six random dates that do not belong to any snowfall_category
# N = 6 to balance observations (six snowfall categories)
# Create list of dates that *cannot* be used for controls
snowfall_dates <- snowfall_events %>%
dplyr::group_by(Device) %>%
dplyr::distinct(category_date, .keep_all=TRUE)
# Returns fewer rows than snowfall_events because of 2013-03-21 / 03-22
rm(snowfall_events)
snowfall_dates <- plyr::rbind.fill(snowfall_dates,random_telem)
# If SnowAccum >= 5, we want that "CamDate" to be coded as "snowfall"
# From there, assign values to 1 and 2 days before the snowfall
# And to 1, 2, and 3 days after
# Isolate snowfall events
snowfall_events <- telem_snow %>%
filter(SnowAccum >= 5) %>%
# distinct(Camera,CamDate,.keep_all=TRUE) %>% # 35 unique snowstorms
distinct(Device,CamDate,.keep_all=TRUE) %>% # 57 total observations
select(Camera,CamDate,SnowAccum,SnowDepth,Device) %>%
dplyr::arrange(CamDate)
length(unique(snowfall_events$Device)) # Across 17 collars
# Compute summary statistics
# How many snowfall events did each wolf experience
summary <- snowfall_events %>%
group_by(Device) %>%
summarize(no_of_snowfall = length(unique(CamDate)))
mean(summary$no_of_snowfall) # x = 3.35 snowfall events per wolf
sd(summary$no_of_snowfall) # sd = 2.17
range(summary$no_of_snowfall) # range = 1 to 7
rm(summary)
# Issues:
# Device IDs 33670, 33673, and 33675 experienced a snowfall
# on two consecutive days: 2013-03-21 and 2013-03-22
# Snowfalls on 2013-01-18 and 2013-01-24 have overlapping dates if
# selecting from three days before to three days after
# Selecting from two days before to three days after would avoid overlap
snowfall_events <- snowfall_events %>%
mutate(two_before = CamDate - 2,
one_before = CamDate - 1,
one_after = CamDate + 1, two_after = CamDate + 2,
three_after = CamDate + 3)
# For 03-21 and 03-22, code both days as "snowfall", and start
# working backwards from 2013-03-21 and forwards from 2013-03-22
for (i in 1:nrow(snowfall_events)) {
if (snowfall_events$CamDate[i] == "2013-03-21"){
snowfall_events$one_after[i] = snowfall_events$CamDate[i] + 2
snowfall_events$two_after[i] = snowfall_events$CamDate[i] + 3
snowfall_events$three_after[i] = snowfall_events$CamDate[i] + 4
}
else if (snowfall_events$CamDate[i] == "2013-03-22"){
snowfall_events$one_before[i] = snowfall_events$CamDate[i] - 2
snowfall_events$two_before[i] = snowfall_events$CamDate[i] - 3
} else {
}
}
rm(i)
# Switch to long format
snowfall_events <- snowfall_events %>%
rename(day_of_snowfall = CamDate) %>%
tidyr::gather(key = snowfall_category, value = category_date,
one_before,two_before, day_of_snowfall, one_after,
two_after, three_after) %>%
group_by(Device) %>%
dplyr::arrange(Device,category_date)
# Create controls
# Controls are six random dates that do not belong to any snowfall_category
# N = 6 to balance observations (six snowfall categories)
# Create list of dates that *cannot* be used for controls
snowfall_dates <- snowfall_events %>%
dplyr::group_by(Device) %>%
dplyr::distinct(category_date, .keep_all=TRUE)
# Returns fewer rows than snowfall_events because of 2013-03-21 / 03-22
rm(snowfall_events)
snowfall_dates <- plyr::rbind.fill(snowfall_dates,random_dates)
write.csv(snowfall_dates,'data/outputs/snowfall_category_dates.csv',
row.names=F)
rm(random_telem,snowfall_dates)
rm(random_telem,snowfall_dates,random_dates)
travel_speed_summary <- snowfall_telem %>%
filter(Behavior==1 & !is.na(speed)) %>% # Only include travelling behaviour
group_by(Device,snowfall_category) %>%
summarize(mean.speed = mean(speed), sd.speed = sd(speed),
no_of_obs = length(Hour))
# Create snowfall categories
# If SnowAccum >= 5, we want that "CamDate" to be coded as "snowfall"
# From there, assign values to 1 and 2 days before the snowfall
# And to 1, 2, and 3 days after
# Isolate snowfall events
snowfall_events <- telem_snow %>%
filter(SnowAccum >= 5) %>%
# distinct(Camera,CamDate,.keep_all=TRUE) %>% # 35 unique snowstorms
distinct(Device,CamDate,.keep_all=TRUE) %>% # 57 total observations
select(Camera,CamDate,SnowAccum,SnowDepth,Device) %>%
dplyr::arrange(CamDate)
length(unique(snowfall_events$Device)) # Across 17 collars
# Compute summary statistics
# How many snowfall events did each wolf experience
summary <- snowfall_events %>%
group_by(Device) %>%
summarize(no_of_snowfall = length(unique(CamDate)))
mean(summary$no_of_snowfall) # x = 3.35 snowfall events per wolf
sd(summary$no_of_snowfall) # sd = 2.17
range(summary$no_of_snowfall) # range = 1 to 7
rm(summary)
# Issues:
# Device IDs 33670, 33673, and 33675 experienced a snowfall
# on two consecutive days: 2013-03-21 and 2013-03-22
# Snowfalls on 2013-01-18 and 2013-01-24 have overlapping dates if
# selecting from three days before to three days after
# Selecting from two days before to three days after would avoid overlap
snowfall_events <- snowfall_events %>%
mutate(two_before = CamDate - 2,
one_before = CamDate - 1,
one_after = CamDate + 1, two_after = CamDate + 2,
three_after = CamDate + 3)
# For 03-21 and 03-22, code both days as "snowfall", and start
# working backwards from 2013-03-21 and forwards from 2013-03-22
for (i in 1:nrow(snowfall_events)) {
if (snowfall_events$CamDate[i] == "2013-03-21"){
snowfall_events$one_after[i] = snowfall_events$CamDate[i] + 2
snowfall_events$two_after[i] = snowfall_events$CamDate[i] + 3
snowfall_events$three_after[i] = snowfall_events$CamDate[i] + 4
}
else if (snowfall_events$CamDate[i] == "2013-03-22"){
snowfall_events$one_before[i] = snowfall_events$CamDate[i] - 2
snowfall_events$two_before[i] = snowfall_events$CamDate[i] - 3
} else {
}
}
rm(i)
# Switch to long format
snowfall_events <- snowfall_events %>%
rename(day_of_snowfall = CamDate) %>%
tidyr::gather(key = snowfall_category, value = category_date,
one_before,two_before, day_of_snowfall, one_after,
two_after, three_after) %>%
group_by(Device) %>%
dplyr::arrange(Device,category_date)
# Create controls
# Controls are three random dates that do not belong to any snowfall_category
# N = 3 to balance number of observations
# Create list of dates that *cannot* be used for controls
snowfall_dates <- snowfall_events %>%
dplyr::group_by(Device) %>%
dplyr::distinct(category_date, .keep_all=TRUE)
# Returns fewer rows than snowfall_events because of 2013-03-21 / 03-22
rm(snowfall_events)
random_dates <- telem_snow %>%
filter(!is.na(speed)) %>%
filter(!is.na(SnowAccum)) %>%
group_by(Device) %>%
filter(!(CamDate %in% snowfall_dates$category_date)) %>%
sample_n(3,replace = FALSE) %>%
select(Device,CamDate)
# 6 observations * 17 wolves = 102 random dates
# Subset telemetry date to only include these random dates
random_telem <- telem_snow %>%
group_by(Device) %>%
filter(CamDate %in% random_dates$CamDate)
random_telem$snowfall_category = "control"
random_dates$snowfall_category = "control"
# Check
# max(random_telem$SnowAccum) # Should not be >= 5 cm
# Subset telem_snow to only include snowfall_dates
# Then merge with random_telem
# Left join by Device and category_date = CamDate
# Remove repeating columns
snowfall_dates <- snowfall_dates %>%
select(-c(Camera,SnowAccum,SnowDepth))
snowfall_telem <- right_join(telem_snow,snowfall_dates,
by = c("Device" = "Device",
"CamDate" = "category_date"))
snowfall_telem <- plyr::rbind.fill(snowfall_telem,random_telem)
unique(snowfall_telem$snowfall_category)
# Export category dates for reference
random_dates <- random_dates %>%
rename(category_date = CamDate) %>%
select(Device,snowfall_category,category_date)
snowfall_dates <- plyr::rbind.fill(snowfall_dates,random_dates)
write.csv(snowfall_dates,'data/outputs/snowfall_category_dates.csv',
row.names=F)
rm(random_telem,snowfall_dates,random_dates)
travel_speed_summary <- snowfall_telem %>%
filter(Behavior==1 & !is.na(speed)) %>% # Only include travelling behaviour
group_by(Device,snowfall_category) %>%
summarize(mean.speed = mean(speed), sd.speed = sd(speed),
no_of_obs = length(Hour))
View(snowfall_telem)
View(telem_snow)
View(travel_speed_summary)
install.packages("car")
library(car)
##QQplot for normality - good enough for me
qqPlot(travel_speed_summary$speed,
pch=20,ylab="Average travel speed (m/min)",xlab="Normal quantiles")
##QQplot for normality - good enough for me
qqPlot(travel_speed_summary$mean.speed,
pch=20,ylab="Average travel speed (m/min)",xlab="Normal quantiles")
View(travel_speed_summary)
install.packages("ez")
library(ez)
# Sphericity test
travel_speed_summary$snowfall_category <- factor(travel_speed_summary$snowfall_category) ##drop unused factors as this is causing error messages
travel_speed_summary$Device <- factortravel_speed_summary$Device)
travel_speed_summary$Device <- factortravel_speed_summary$Device
travel_speed_summary$Device <- factor(travel_speed_summary$Device)
ezANOVA(data=travel_speed_summary, dv=.(mean.speed),
wid=.(Device), within=.(snowfall_category), detailed=TRUE)
ezANOVA(data=travel_speed_summary, dv=.(mean.speed),
wid=.(Device), within=.(snowfall_category), detailed=TRUE)
Model<-lme(sp ~ storm, random = ~1|Device_ID/storm,data=AMsum)
??lme
install.packages("lme4")
install.packages("lme4")
library(lme4)
install.packages("lme4")
library(lme4)
Model<-lme(sp ~ storm, random = ~1|Device_ID/storm,data=AMsum)
install.packages("nlme")
install.packages("nlme")
library(nlme)
Model<-lme(sp ~ storm, random = ~1|Device_ID/storm,data=AMsum)
# Run the ANOVA test
mean_speed_model <- lme(mean.speed ~ snowfall_category, random = ~1|Device/snowfall_category,
data=travel_speed_summary)
options(contrasts=c("contr.sum","contr.poly"))
# Run the ANOVA test
options(contrasts=c("contr.sum","contr.poly"))
mean_speed_model <- lme(mean.speed ~ snowfall_category, random = ~1|Device/snowfall_category,
data=travel_speed_summary)
anova(Model)
anova(mean_speed_model)
summary(glht(mean_speed_model,linfct=mcp(storm="Tukey")))
install.packages("multcomp")
library(multcomp)
# Summarize data by ID and snowfall category
travel_speed_summary <- snowfall_telem %>%
filter(Behavior==1 & !is.na(speed)) %>% # Only include travelling behaviour
group_by(Device,snowfall_category,time_of_day) %>%
summarize(mean.speed = mean(speed), sd.speed = sd(speed),
no_of_obs = length(Hour))
# Load required packages
library(plyr)
library(dplyr)
travel_speed_summary <- snowfall_telem %>%
filter(Behavior==1 & !is.na(speed)) %>% # Only include travelling behaviour
group_by(Device,snowfall_category,time_of_day) %>%
summarize(mean.speed = mean(speed), sd.speed = sd(speed),
no_of_obs = length(Hour))
View(travel_speed_summary)
## QQplot for normality
qqPlot(travel_speed_summary$mean.speed,
pch=20,ylab="Average travel speed (m/min)",xlab="Normal quantiles")
# Load required packages
library(plyr)
library(dplyr)
library(car)
library(ez)
library(nlme)
## QQplot for normality
qqPlot(travel_speed_summary$mean.speed,
pch=20,ylab="Average travel speed (m/min)",xlab="Normal quantiles")
# Sphericity test
travel_speed_summary$snowfall_category <- factor(travel_speed_summary$snowfall_category)
travel_speed_summary$Device <- factor(travel_speed_summary$Device)
ezANOVA(data=travel_speed_summary, dv=.(mean.speed),
wid=.(Device), within=.(snowfall_category), detailed=TRUE)
mean_speed_model <- lme(mean.speed ~ snowfall_category * time_of_day, random = ~1|Device/snowfall_category,
data=travel_speed_summary)
anova(mean_speed_model)
summary(glht(mean_speed_model,linfct=mcp(storm="Tukey")))
summary(glht(mean_speed_model,linfct=mcp(snowfall_category="Tukey")))
# Run the ANOVA test
options(contrasts=c("contr.sum","contr.poly"))
summary(glht(mean_speed_model,linfct=mcp(snowfall_category="Tukey")))
unique(data_day$time_of_day)
unique(snowfall_telem$time_of_day)
# Separate data in day and night components
data_day <- snowfall_telem %>%
filter(time_of_day == "day")
data_night <- snowfall_telem %>%
filter(time_of_day != "day")
rm(travel_speed_summary)
day_speed_summary <- data_day %>%
filter(Behavior==1 & !is.na(speed)) %>% # Only include travelling behaviour
group_by(Device,snowfall_category,time_of_day) %>%
summarize(mean.speed = mean(speed), sd.speed = sd(speed),
no_of_obs = length(Hour))
View(day_speed_summary)
# Summarize data by ID and snowfall category
day_speed_summary <- data_day %>%
filter(Behavior==1 & !is.na(speed) & Device != 336763) %>% # Only include travelling behaviour
group_by(Device,snowfall_category,time_of_day) %>%
summarize(mean.speed = mean(speed), sd.speed = sd(speed),
no_of_obs = length(Hour))
# Summarize data by ID and snowfall category
day_speed_summary <- data_day %>%
filter(Behavior==1 & !is.na(speed) & Device != 33676) %>% # Only include travelling behaviour
group_by(Device,snowfall_category,time_of_day) %>%
summarize(mean.speed = mean(speed), sd.speed = sd(speed),
no_of_obs = length(Hour))
night_speed_summary <- data_night %>%
filter(Behavior==1 & !is.na(speed)) %>%
group_by(Device,snowfall_category,time_of_day) %>%
summarize(mean.speed = mean(speed), sd.speed = sd(speed),
no_of_obs = length(Hour))
View(night_speed_summary)
day_speed_summary <- data_day %>%
filter(Behavior==1 & !is.na(speed) & Device != 33676) %>%
group_by(Device,snowfall_category,time_of_day) %>%
summarize(mean.speed = mean(speed), sd.speed = sd(speed),
no_of_obs = length(Hour))
night_speed_summary <- data_night %>%
filter(Behavior==1 & !is.na(speed)  & Device != 33676) %>%
group_by(Device,snowfall_category,time_of_day) %>%
summarize(mean.speed = mean(speed), sd.speed = sd(speed),
no_of_obs = length(Hour))
## QQplot for normality
qqPlot(day_speed_summary$mean.speed,
pch=20,ylab="Average travel speed (m/min)",xlab="Normal quantiles")
qqPlot(night_speed_summary$mean.speed,
pch=20,ylab="Average travel speed (m/min)",xlab="Normal quantiles")
day_speed_summary$snowfall_category <- factor(day_speed_summary$snowfall_category)
day_speed_summary$Device <- factor(day_speed_summary$Device)
night_speed_summary$snowfall_category <- factor(night_speed_summary$snowfall_category)
night_speed_summary$Device <- factor(night_speed_summary$Device)
# Sphericity test
ezANOVA(data=day_speed_summary, dv=.(mean.speed),
wid=.(Device), within=.(snowfall_category), detailed=TRUE)
# Sphericity test
ezANOVA(data=night_speed_summary, dv=.(mean.speed),
wid=.(Device), within=.(snowfall_category), detailed=TRUE)
day_speed_summary <- data_day %>%
filter(Behavior==1 & !is.na(speed) & Device != 33676) %>%
group_by(Device,snowfall_category,time_of_day) %>%
summarize(mean.speed = mean(speed), sd.speed = sd(speed),
no_of_obs = length(Hour))
day_speed_summary$snowfall_category <- factor(day_speed_summary$snowfall_category)
day_speed_summary$Device <- factor(day_speed_summary$Device)
night_speed_summary <- data_night %>%
filter(Behavior==1 & !is.na(speed)  & Device != 33676) %>%
group_by(Device,snowfall_category,time_of_day) %>%
summarize(mean.speed = mean(speed), sd.speed = sd(speed),
no_of_obs = length(Hour))
night_speed_summary$snowfall_category <- factor(night_speed_summary$snowfall_category)
night_speed_summary$Device <- factor(night_speed_summary$Device)
# Check assumptions
## QQplot for normality
qqPlot(day_speed_summary$mean.speed,
pch=20,ylab="Average travel speed (m/min)",xlab="Normal quantiles")
qqPlot(night_speed_summary$mean.speed,
pch=20,ylab="Average travel speed (m/min)",xlab="Normal quantiles")
# Sphericity test
ezANOVA(data=night_speed_summary, dv=.(mean.speed),
wid=.(Device), within=.(snowfall_category), detailed=TRUE)
ezANOVA(data=day_speed_summary, dv=.(mean.speed),
wid=.(Device), within=.(snowfall_category), detailed=TRUE)
View(day_speed_summary)
day_speed_summary %>%
group_by(Device) %>%
summarize(obs = length(snowfall_category))
mean_speed_model <- lme(mean.speed ~ snowfall_category, random = ~1|Device/snowfall_category,
data=day_speed_summary)
anova(mean_speed_model)
rm(day_speed_model)
rm(mean_speed_model)
night_speed_model <- lme(mean.speed ~ snowfall_category, random = ~1|Device/snowfall_category,
data=night_speed_summary)
# ANOVA results
anova(day_speed_model)
# Run the ANOVA test
options(contrasts=c("contr.sum","contr.poly"))
day_speed_model <- lme(mean.speed ~ snowfall_category, random = ~1|Device/snowfall_category,
data=day_speed_summary)
night_speed_model <- lme(mean.speed ~ snowfall_category, random = ~1|Device/snowfall_category,
data=night_speed_summary)
# ANOVA results
anova(day_speed_model)
anova(night_speed_model)
summary(glht(night_speed_model,linfct=mcp(snowfall_category="Tukey")))
night_speed_model <- lme(mean.speed ~ snowfall_category, random = ~1|Device,
data=night_speed_summary)
anova(night_speed_model)
summary(glht(night_speed_model,linfct=mcp(snowfall_category="Tukey")))
plot(night_speed_summary$mean.speed,night_speed_summary$snowfall_category)
plot(night_speed_summary$snowfall_category,night_speed_summary$mean.speed)
library(lme4)
unique(data_day$snowfall_category)
data_day <- within(data_day, snowfall_category <-
relevel(snowfall_category, ref = "day_of_snowfall"))
data_day$snowfall_category <- as.factor(data_day$snowfall_category)
data_day <- within(data_day, snowfall_category <-
relevel(snowfall_category, ref = "day_of_snowfall"))
day_proportion_model <- glmer(Behavior ~ snowfall_category +
(1|Device),data=data_day, family=binomial)
summary(day_proportion_model)
plot(data_day$snowfall_category,data_day$Behavior)
plot(data_day$Behavior,data_day$snowfall_category)
plot(as.factor(data_day$Behavior),data_day$snowfall_category)
plot(data_day$snowfall_category,as.factor(data_day$Behavior))
levels(data_day$snowfall_category)
data_day %>%
group_by(Device) %>%
summarize(travel = sum(Behavior),no_of_obs = length(Behavior),
proportion = travel/no_of_obs)
data_day %>%
group_by(Device,snowfall_category) %>%
summarize(travel = sum(Behavior),no_of_obs = length(Behavior),
proportion = travel/no_of_obs)
write.csv(snowfall_telem,'data/outputs/telem_with_snow_categories.csv',row.names=F)
